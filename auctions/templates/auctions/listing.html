{% extends "auctions/layout.html" %}

{% block body %}
    <h1>{{ listing.title }}</h1>
    <div>{{ listing.description }}</div>
    <div>{{ listing.starting_bid }}</div>
    <div><img src="{{ listing.image_url }}"></div>
    <div>{{ listing.category }}</div>
    <div>{{ listing.poster }}</div>
    {% if user.is_authenticated %}
        <form action="{% url 'listing' listing.id %}" method="post">
            {% csrf_token %}
            {% if user in listing.watchers.all %}
            <input class="btn btn-primary" type="submit" value="remove from watchlist" name="watchlist">
            {% else %}
            <input class="btn btn-primary" type="submit" value="add to watchlist" name="watchlist">
            {% endif %}
        </form>
        <form action="{% url 'listing' listing.id %}" method="post">
            {% csrf_token %}
            {% if listing.starting_bid > listing.current_bid_default %}
        
            <div>Start bidding, minimal: {{ listing.starting_bid }}</div>
            <div class="form-group">
                <label for="bidd">Your bid</label>
                <input class="form-control" autofocus type="number" name="starting_bid" placeholder="your bid" id="bidd">
                <div>
                    {% if messages %}
                    {% for message in messages %}
                    {{ message }}
                    {% endfor %}
                    {% endif %}
                </div>
                <input class="btn btn-primary" type="submit" value="Bid">
            </div>
            {% else %}
            <div>Current bid: {{ listing.current_bid_default }}</div>
            <div class="form-group">
                <label for="bidd">Your bid</label>
                <input class="form-control" autofocus type="number" name="current_bid" placeholder="your bid" id="bidd">
                <div>
                    {% if messages %}
                    {% for message in messages %}
                    {{ message }}
                    {% endfor %}
                    {% endif %}
                </div>
                <input class="btn btn-primary" type="submit" value="Bid">
            </div>
            {% endif %}
        </form>
            {% if user == listing.poster %}
                <form action="{% url 'listing' listing.id %}" method="post">
                {% csrf_token %}
                <input class="btn btn-primary" type="submit" value="Close auction" name="closed">
                </form>
            {% endif %}
        
            <form action="{% url 'listing' listing.id %}" method="post">
                {% csrf_token %}
                <input class="form-control" autofocus type="text" name="comment_text" placeholder="text....">
                <input class="btn btn-primary" type="submit" value="comment" name="add comment">
            </form>
            

    {% endif %}
    {% if comments %}
        {% for comment in comments %}
            {{ comment }}
        {% endfor %}
    {% endif %}
    
{% endblock %}